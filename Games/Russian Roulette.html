<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Russian Roulette - 10 Players</title>
		<style>
			:root {
				--bg: #191b1a;
				--panel: #1a1f27;
				--panel-2: #232a35;
				--text: #f3f4f6;
				--muted: #9aa3b2;
				--accent: #d8b15a;
				--danger: #f14c4c;
				--ok: #54d18b;
				--wood-dark: #2f241a;
				--wood-mid: #4a3727;
				--wood-light: #5f4633;
				--felt: #2a3b2f;
				--felt-dark: #1c271f;
				--grime: rgba(0, 0, 0, 0.35);
			}

			* {
				box-sizing: border-box;
			}

			body {
				margin: 0;
				font-family: "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande",
					"Lucida Sans", Arial, sans-serif;
				background-color: var(--bg);
				background-image:
					radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.06), transparent 50%),
					radial-gradient(circle at 80% 10%, rgba(0, 0, 0, 0.35), transparent 55%),
					repeating-linear-gradient(
						45deg,
						rgba(255, 255, 255, 0.03) 0px,
						rgba(255, 255, 255, 0.03) 4px,
						rgba(0, 0, 0, 0.06) 8px,
						rgba(0, 0, 0, 0.06) 12px
					),
					radial-gradient(circle at 50% 70%, #2a2c2b, #141615 68%);
				color: var(--text);
				min-height: 100vh;
			}

			.wrap {
				max-width: 1320px;
				margin: 0 auto;
				padding: 24px 18px 40px;
				position: relative;
			}

			.wrap::before {
				content: "";
				position: fixed;
				inset: 0;
				background:
					radial-gradient(circle at 50% 40%, rgba(0, 0, 0, 0.18), transparent 55%),
					radial-gradient(circle at 30% 75%, rgba(115, 22, 22, 0.35), transparent 35%);
				pointer-events: none;
				mix-blend-mode: multiply;
				z-index: -1;
			}

			header {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 16px;
				margin-bottom: 18px;
			}

			h1 {
				font-size: 28px;
				letter-spacing: 0.5px;
				margin: 0;
			}

			.btn {
				background: var(--accent);
				color: #151515;
				border: none;
				padding: 10px 16px;
				border-radius: 8px;
				font-weight: 700;
				cursor: pointer;
				transition: transform 0.08s ease, opacity 0.2s ease;
			}

			.btn:active {
				transform: scale(0.98);
			}

			.btn.secondary {
				background: var(--panel-2);
				color: var(--text);
			}

			.btn.danger {
				background: var(--danger);
				color: #fff;
			}

			.grid {
				display: grid;
				grid-template-columns: 1.7fr 0.9fr;
				gap: 16px;
			}

			.card {
				background: rgba(26, 31, 39, 0.92);
				border-radius: 12px;
				padding: 16px;
				border: 1px solid #2a313d;
				backdrop-filter: blur(3px);
			}

			.status {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 16px;
				margin-bottom: 12px;
			}

			.turn {
				font-size: 18px;
				font-weight: 700;
			}

			.timer {
				font-size: 20px;
				color: var(--accent);
			}

			.controls {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
			}

			.log {
				max-height: 260px;
				overflow: auto;
				padding-right: 6px;
				background: var(--panel-2);
				border-radius: 10px;
				padding: 12px;
				border: 1px solid #2a313d;
			}

			.log p {
				margin: 0 0 8px;
				color: var(--muted);
			}

			.log p strong {
				color: var(--text);
			}

			.table-card {
				padding: 12px;
				background: transparent;
				border: none;
			}

			.table-area {
				position: relative;
				width: 100%;
				min-height: 740px;
				display: flex;
				align-items: center;
				justify-content: center;
				filter: drop-shadow(0 16px 22px rgba(0, 0, 0, 0.35));
			}

			.table {
				position: relative;
				width: min(100%, 1220px);
				aspect-ratio: 1.2 / 1;
				border-radius: 20% / 20%;
				background-image: url("/images/Russian Rulette Table.png");
				background-size: cover;
				background-position: center;
				border: 10px solid #2a1e16;
				box-shadow: inset 0 0 0 4px rgba(0, 0, 0, 0.2);
				overflow: hidden;
			}

			.table::before {
				content: "";
				position: absolute;
				inset: 0;
				background:
					radial-gradient(circle at 50% 30%, rgba(0, 0, 0, 0.25), transparent 55%),
					radial-gradient(circle at 50% 80%, rgba(0, 0, 0, 0.35), transparent 60%);
				mix-blend-mode: multiply;
				opacity: 0.6;
			}

			.table-felt {
				position: absolute;
				inset: 32px;
				border-radius: 50% / 42%;
				background: transparent;
				box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.45);
				border: none;
			}

			.table-felt::after {
				content: none;
			}

			.seat-layer {
				position: absolute;
				inset: 0;
				pointer-events: none;
			}

			.seat {
				position: absolute;
				transform: translate(-50%, -50%);
				min-width: 94px;
				padding: 8px 10px;
				border-radius: 10px;
				background: rgba(22, 27, 35, 0.82);
				border: 1px solid rgba(255, 255, 255, 0.08);
				text-align: center;
				box-shadow: 0 8px 12px rgba(0, 0, 0, 0.35);
			}

			.seat .seat-name {
				font-weight: 700;
				font-size: 13px;
			}

			.seat .seat-state {
				font-size: 11px;
				color: var(--muted);
			}

			.seat.dead {
				opacity: 0.45;
				border-color: rgba(241, 76, 76, 0.4);
			}

			.seat.active {
				outline: 2px solid var(--accent);
			}

			.revolver {
				position: absolute;
				width: 120px;
				height: 48px;
				background-image: url("/images/Revolver.png");
				background-size: contain;
				background-repeat: no-repeat;
				background-position: center;
				transition: transform 0.6s cubic-bezier(0.25, 0.7, 0.35, 1),
					opacity 0.3s ease;
				opacity: 0;
				transform-origin: center;
			}

			.revolver.active {
				opacity: 1;
			}

			.revolver.recoil {
				animation: recoil 0.25s ease;
			}

			@keyframes recoil {
				0% {
					transform: translate(var(--revolver-x), var(--revolver-y))
						rotate(var(--revolver-rot));
				}
				50% {
					transform: translate(calc(var(--revolver-x) - 6px), var(--revolver-y))
						rotate(var(--revolver-rot));
				}
				100% {
					transform: translate(var(--revolver-x), var(--revolver-y))
						rotate(var(--revolver-rot));
				}
			}

			.player-list {
				margin-top: 12px;
				display: grid;
				gap: 8px;
			}

			.player-row {
				background: var(--panel-2);
				border-radius: 10px;
				border: 1px solid #2a313d;
				padding: 8px 10px;
				display: flex;
				justify-content: space-between;
				gap: 8px;
				font-size: 13px;
			}

			.player-row.dead {
				opacity: 0.5;
				border-color: rgba(241, 76, 76, 0.4);
			}

			.overlay {
				position: fixed;
				inset: 0;
				background: rgba(8, 10, 12, 0.8);
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
			}

			.menu {
				width: min(640px, 100%);
				background: var(--panel);
				border-radius: 14px;
				padding: 22px;
				border: 1px solid #2a313d;
			}

			.menu h2 {
				margin: 0 0 12px;
			}

			.menu label {
				display: block;
				margin: 8px 0 6px;
				font-size: 14px;
				color: var(--muted);
			}

			.menu select,
			.menu input {
				width: 100%;
				padding: 10px 12px;
				border-radius: 8px;
				border: 1px solid #2a313d;
				background: var(--panel-2);
				color: var(--text);
			}

			.menu .names {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 10px;
				margin-top: 10px;
			}

			.menu .actions {
				display: flex;
				gap: 10px;
				justify-content: flex-end;
				margin-top: 14px;
			}

			.note {
				font-size: 12px;
				color: var(--muted);
				margin-top: 6px;
			}

			.winner {
				color: var(--ok);
				font-weight: 700;
			}

			@media (max-width: 820px) {
				.grid {
					grid-template-columns: 1fr;
				}

				.table-area {
					min-height: 420px;
				}
			}
		</style>
	</head>
	<body>
		<div class="wrap">
			<header>
				<h1>Russian Roulette</h1>
				<div class="controls">
					<button class="btn secondary" id="open-menu">Game Menu</button>
					<button class="btn danger" id="reset-game">Reset</button>
				</div>
			</header>

			<div class="grid">
				<section class="card table-card">
					<div class="table-area" id="table-area">
						<div class="table" id="table">
							<div class="table-felt"></div>
							<div class="seat-layer" id="seat-layer"></div>
							<div class="revolver" id="revolver"></div>
						</div>
					</div>
				</section>

				<section class="card">
					<div class="status">
						<div class="turn" id="turn-label">Waiting to start...</div>
						<div class="timer" id="timer">30</div>
					</div>
					<div class="controls">
						<button class="btn" id="pull-trigger">Pull Trigger</button>
						<button class="btn secondary" id="end-turn">End Turn</button>
					</div>
					<p class="note">
						Each player has 30 seconds. You can pull as many times as you want before
						ending your turn.
					</p>
					<div class="log" id="log"></div>
					<div class="player-list" id="player-list"></div>
				</section>
			</div>
		</div>
		<audio id="start-sfx" src="/Audio/Russian Rulette Start.mp3" preload="auto"></audio>
		<audio id="spin-sfx" src="/Audio/Russian Rulette Spin.mp3" preload="auto"></audio>
		<audio id="shot-sfx" src="/Audio/Gun Shot.mp3" preload="auto"></audio>
		<audio id="dry-sfx" src="/Audio/Dry Fire.mp3" preload="auto"></audio>

		<div class="overlay" id="menu">
			<div class="menu">
				<h2>Game Setup</h2>
				<label for="player-count">Number of players</label>
				<select id="player-count"></select>
				<div class="names" id="name-fields"></div>
				<div class="note">
					All players must enter a name before the game starts.
				</div>
				<div class="actions">
					<button class="btn secondary" id="close-menu">Close</button>
					<button class="btn" id="start-game">Start Game</button>
				</div>
			</div>
		</div>

		<script>
			const playerCountSelect = document.getElementById("player-count");
			const nameFields = document.getElementById("name-fields");
			const startGameBtn = document.getElementById("start-game");
			const closeMenuBtn = document.getElementById("close-menu");
			const menu = document.getElementById("menu");
			const openMenuBtn = document.getElementById("open-menu");
			const resetGameBtn = document.getElementById("reset-game");
			const seatLayer = document.getElementById("seat-layer");
			const playerListEl = document.getElementById("player-list");
			const tableArea = document.getElementById("table-area");
			const tableEl = document.getElementById("table");
			const revolverEl = document.getElementById("revolver");
			const logEl = document.getElementById("log");
			const startSfx = document.getElementById("start-sfx");
			const spinSfx = document.getElementById("spin-sfx");
			const shotSfx = document.getElementById("shot-sfx");
			const drySfx = document.getElementById("dry-sfx");
			const pullTriggerBtn = document.getElementById("pull-trigger");
			const endTurnBtn = document.getElementById("end-turn");
			const turnLabel = document.getElementById("turn-label");
			const timerEl = document.getElementById("timer");

			const MAX_PLAYERS = 10;
			const MIN_PLAYERS = 2;
			const TURN_SECONDS = 30;

			let players = [];
			let currentPlayerIndex = 0;
			let timerId = null;
			let timeLeft = TURN_SECONDS;
			let bulletIndex = 0;
			let chamberIndex = 0;
			let gameActive = false;
			let seatPositions = [];

			const REVOLVER_WIDTH = 120;
			const REVOLVER_HEIGHT = 48;

			function resetAudioOnEnd(audio) {
				if (!audio) {
					return;
				}
				audio.addEventListener("ended", () => {
					audio.currentTime = 0;
				});
			}

			let audioUnlocked = false;

			function unlockAudio() {
				if (audioUnlocked) {
					return;
				}
				[startSfx, spinSfx, shotSfx, drySfx].forEach((audio) => {
					if (!audio) {
						return;
					}
					audio.volume = 1;
					audio.play()
						.then(() => {
							audio.pause();
							audio.currentTime = 0;
						})
						.catch(() => {});
				});
				audioUnlocked = true;
			}

			function playSpinSound() {
				if (!spinSfx) {
					return;
				}
				unlockAudio();
				spinSfx.pause();
				spinSfx.currentTime = 0;
				spinSfx.play().catch(() => {});
			}

			function playStartSound() {
				if (!startSfx) {
					return;
				}
				unlockAudio();
				startSfx.pause();
				startSfx.currentTime = 0;
				startSfx.play().catch(() => {});
			}

			function playShotSound() {
				if (!shotSfx) {
					return;
				}
				unlockAudio();
				shotSfx.pause();
				shotSfx.currentTime = 0;
				shotSfx.play().catch(() => {});
			}

			function playDrySound() {
				if (!drySfx) {
					return;
				}
				unlockAudio();
				drySfx.pause();
				drySfx.currentTime = 0;
				drySfx.play().catch(() => {});
			}

			function setupPlayerCountOptions() {
				for (let i = MIN_PLAYERS; i <= MAX_PLAYERS; i += 1) {
					const option = document.createElement("option");
					option.value = i;
					option.textContent = i;
					if (i === MAX_PLAYERS) {
						option.selected = true;
					}
					playerCountSelect.appendChild(option);
				}
			}

			function buildNameFields(count) {
				nameFields.innerHTML = "";
				for (let i = 0; i < count; i += 1) {
					const input = document.createElement("input");
					input.type = "text";
					input.placeholder = `Player ${i + 1} name`;
					input.maxLength = 20;
					input.dataset.index = i;
					nameFields.appendChild(input);
				}
			}

			function readNames() {
				const inputs = [...nameFields.querySelectorAll("input")];
				const names = inputs.map((input) => input.value.trim());
				const emptyIndex = names.findIndex((name) => name.length === 0);
				if (emptyIndex !== -1) {
					inputs[emptyIndex].focus();
					return null;
				}
				return names;
			}

			function setLog(message, highlight = false) {
				const entry = document.createElement("p");
				if (highlight) {
					entry.innerHTML = `<strong>${message}</strong>`;
				} else {
					entry.textContent = message;
				}
				logEl.prepend(entry);
			}

			function randomizeRevolver() {
				bulletIndex = Math.floor(Math.random() * 6);
				chamberIndex = Math.floor(Math.random() * 6);
			}

			function getAlivePlayers() {
				return players.filter((player) => player.alive);
			}

			function renderPlayers() {
				seatLayer.innerHTML = "";
				playerListEl.innerHTML = "";
				players.forEach((player, index) => {
					const seat = document.createElement("div");
					seat.className = "seat";
					if (!player.alive) {
						seat.classList.add("dead");
					}
					if (index === currentPlayerIndex && player.alive && gameActive) {
						seat.classList.add("active");
					}
					seat.innerHTML = `
						<div class="seat-name">${player.name}</div>
						<div class="seat-state">${player.alive ? "Alive" : "Eliminated"}</div>
					`;
					seatLayer.appendChild(seat);

					const row = document.createElement("div");
					row.className = "player-row";
					if (!player.alive) {
						row.classList.add("dead");
					}
					row.innerHTML = `
						<span>${player.name}</span>
						<span>${player.alive ? "Alive" : "Out"}</span>
					`;
					playerListEl.appendChild(row);
				});
				updateSeatLayout();
			}

			function updateSeatLayout() {
				if (!tableEl || players.length === 0) {
					return;
				}
				const tableRect = tableEl.getBoundingClientRect();
				const centerX = tableRect.width / 2;
				const centerY = tableRect.height / 2;
				const radius = Math.min(centerX, centerY) * 0.9;

				seatPositions = players.map((_, index) => {
					const angleDeg = -90 + (360 / players.length) * index;
					const angleRad = (angleDeg * Math.PI) / 180;
					return {
						x: centerX + Math.cos(angleRad) * radius,
						y: centerY + Math.sin(angleRad) * radius,
						angle: angleDeg,
					};
				});

				const seats = seatLayer.querySelectorAll(".seat");
				seats.forEach((seat, index) => {
					const pos = seatPositions[index];
					if (!pos) {
						return;
					}
					seat.style.left = `${pos.x}px`;
					seat.style.top = `${pos.y}px`;
				});

				moveRevolver();
			}

			function moveRevolver() {
				if (!gameActive || players.length === 0) {
					revolverEl.classList.remove("active");
					return;
				}
				const pos = seatPositions[currentPlayerIndex];
				if (!pos) {
					return;
				}
				const centerX = tableEl.clientWidth / 2;
				const centerY = tableEl.clientHeight / 2;
				const radius = Math.min(centerX, centerY) * 0.55;
				const angleRad = (pos.angle * Math.PI) / 180;
				const x = centerX + Math.cos(angleRad) * radius;
				const y = centerY + Math.sin(angleRad) * radius;
				const rotation = pos.angle + 90;
				const offsetX = x - REVOLVER_WIDTH / 2;
				const offsetY = y - REVOLVER_HEIGHT / 2;
				revolverEl.style.transform = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation}deg)`;
				revolverEl.style.setProperty("--revolver-x", `${offsetX}px`);
				revolverEl.style.setProperty("--revolver-y", `${offsetY}px`);
				revolverEl.style.setProperty("--revolver-rot", `${rotation}deg`);
				revolverEl.classList.add("active");
			}

			function updateTurnLabel() {
				if (!gameActive) {
					turnLabel.textContent = "Waiting to start...";
					return;
				}
				const player = players[currentPlayerIndex];
				turnLabel.textContent = `${player.name}'s turn`;
			}

			function resetTimer() {
				timeLeft = TURN_SECONDS;
				timerEl.textContent = timeLeft;
			}

			function stopTimer() {
				if (timerId) {
					clearInterval(timerId);
					timerId = null;
				}
			}

			function startTimer() {
				stopTimer();
				timerId = setInterval(() => {
					if (!gameActive) {
						stopTimer();
						return;
					}
					timeLeft -= 1;
					timerEl.textContent = timeLeft;
					if (timeLeft <= 0) {
						setLog("Time expired. Turn ended.", true);
						endTurn();
					}
				}, 1000);
			}

			function nextAlivePlayer(startIndex) {
				let index = startIndex;
				for (let i = 0; i < players.length; i += 1) {
					index = (index + 1) % players.length;
					if (players[index].alive) {
						return index;
					}
				}
				return startIndex;
			}

			function checkWinner() {
				const alivePlayers = getAlivePlayers();
				if (alivePlayers.length === 1) {
					gameActive = false;
					stopTimer();
					turnLabel.innerHTML = `<span class="winner">${alivePlayers[0].name} wins!</span>`;
					setLog(`${alivePlayers[0].name} is the last player standing!`, true);
					renderPlayers();
					return true;
				}
				return false;
			}

			function startGame(names) {
				players = names.map((name) => ({ name, alive: true }));
				currentPlayerIndex = 0;
				gameActive = true;
				randomizeRevolver();
				logEl.innerHTML = "";
				setLog("New game started.", true);
				playStartSound();
				resetTimer();
				startTimer();
				updateTurnLabel();
				renderPlayers();
				requestAnimationFrame(() => {
					updateSeatLayout();
					moveRevolver();
				});
			}

			function pullTrigger() {
				if (!gameActive) {
					return;
				}
				const player = players[currentPlayerIndex];
				if (!player.alive) {
					return;
				}
				revolverEl.classList.add("recoil");
				setTimeout(() => {
					revolverEl.classList.remove("recoil");
				}, 260);

				if (chamberIndex === bulletIndex) {
					player.alive = false;
					setLog(`${player.name} pulled the trigger... BANG!`, true);
					playShotSound();
					setTimeout(playStartSound, 200);
					randomizeRevolver();
					renderPlayers();
					if (!checkWinner()) {
						endTurn(true);
					}
					return;
				}
				setLog(`${player.name} pulled the trigger... click.`);
				playDrySound();
				chamberIndex = (chamberIndex + 1) % 6;
				renderPlayers();
			}

			function endTurn(forced = false) {
				if (!gameActive) {
					return;
				}
				const player = players[currentPlayerIndex];
				if (player.alive) {
					if (forced) {
						setLog(`${player.name}'s turn ended.`, true);
					} else {
						setLog(`${player.name} ended their turn.`, true);
					}
				}
				currentPlayerIndex = nextAlivePlayer(currentPlayerIndex);
				playSpinSound();
				resetTimer();
				updateTurnLabel();
				renderPlayers();
				moveRevolver();
			}

			function resetGame() {
				gameActive = false;
				stopTimer();
				players = [];
				currentPlayerIndex = 0;
				timeLeft = TURN_SECONDS;
				timerEl.textContent = timeLeft;
				logEl.innerHTML = "";
				turnLabel.textContent = "Waiting to start...";
				seatLayer.innerHTML = "";
				playerListEl.innerHTML = "";
				revolverEl.classList.remove("active");
			}

			playerCountSelect.addEventListener("change", (event) => {
				buildNameFields(Number(event.target.value));
			});

			startGameBtn.addEventListener("click", () => {
				const names = readNames();
				if (!names) {
					setLog("Please enter all player names.", true);
					return;
				}
				resetGame();
				startGame(names);
				menu.style.display = "none";
			});

			closeMenuBtn.addEventListener("click", () => {
				menu.style.display = "none";
			});

			openMenuBtn.addEventListener("click", () => {
				menu.style.display = "flex";
			});

			resetGameBtn.addEventListener("click", () => {
				resetGame();
				menu.style.display = "flex";
			});

			pullTriggerBtn.addEventListener("click", pullTrigger);
			endTurnBtn.addEventListener("click", () => endTurn(false));

			window.addEventListener("resize", () => {
				updateSeatLayout();
				moveRevolver();
			});

			window.addEventListener("pointerdown", unlockAudio, { once: true });

			setupPlayerCountOptions();
			buildNameFields(MAX_PLAYERS);
			resetAudioOnEnd(startSfx);
			resetAudioOnEnd(spinSfx);
			resetAudioOnEnd(shotSfx);
			resetAudioOnEnd(drySfx);
			resetGame();
		</script>
	</body>
</html>
